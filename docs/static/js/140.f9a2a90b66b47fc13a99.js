webpackJsonp([140],{1200:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(100),o=i.n(n),a=i(99),r=i.n(a),s=(i(101),i(65)),l=(i.n(s),i(22),i(64)),u=i(436),c=i.n(u);e.default={data:function(){return{date:"",editMes:[],loading:!1,detLoading:!1,ticketsDet:!1,title:"",inOutDet:!1,total:0,size:10,currentPage:1,checked:!1,formInline:{startDate:"",endDate:"",keywords:"",typeCode:"",hospitalCode:"",wareHouse:"",IsEnable:"",rangeDetailInJson:!1,batchNumber:!1},allData:[],tableData:[],hospitalList:[],supplierList:[],whList:[],allWhList:[],detData:[],sum:{quantityIn:"",quantityOut:"",remainCount:""},dynamicTags:[]}},computed:{tHeader:function(){return this.ticketsDet?["卡号"]:["仓库","卡券名称","前缀","入库总数","出库总数","库存数量"]},filterVal:function(){return this.ticketsDet?["code"]:["warehouseName","ticketName","ticketPrefixCode","quantityIn","quantityOut","remainingCount"]},tableData1:function(){return this.ticketsDet?this.dynamicTags:this.allData},name:function(){return this.ticketsDet?"剩余库存":"卡券库存"}},mounted:function(){this.date=[new Date,new Date],this.GetDropDownPermission()},methods:{hosChange:function(e){var n=this;this.whList=[],this.formInline.wareHouse="",this.allWhList.forEach(function(t){t.hospitalCode==e&&n.whList.push(t)})},showReaminDet:function(e,n){var a=this;return r()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.title=n,a.dynamicTags=[],a.ticketsDet=!0,t.next=5,i.i(l.p)({TicketId:e.ticketId,TicketCodePre:e.ticketPrefixCode,numcount:e.numCount,warehouseId:e.warehouseId});case 5:t.sent.data.forEach(function(t){a.dynamicTags.push({code:t.ticketCode})});case 7:case"end":return t.stop()}},t,a)}))()},viewTickets:function(e){var n=this;return r()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.ticketsDet=!0,n.dynamicTags=[],(e.ticketCodes?e.ticketCodes.split(","):[]).forEach(function(t){n.dynamicTags.push({code:t})});case 4:case"end":return t.stop()}},t,n)}))()},getSummaries:function(){for(var t=["总合计"],e=(this.checked,4),n=0;n<e;n++)t.push("");return t.concat([Math.round(this.sum.quantityIn).toQFW(),Math.round(this.sum.quantityOut).toQFW(),Math.round(this.sum.remainCount).toQFW(),Math.round(this.sum.remainAmount).toQFW()])},GetDropDownPermission:function(){var a=this;return r()(o.a.mark(function t(){var e,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.i(l.d)({typeId:1});case 2:return e=t.sent,a.hospitalList=e.data,t.next=6,i.i(l.e)({hospitalCode:"",pageIndex:1,pageSize:100,keywords:"",typeId:2});case 6:n=t.sent,a.allWhList=n.data,a.formInline.hospitalCode=a.hospitalList[0].code;case 9:case"end":return t.stop()}},t,a)}))()},GetStockTicket:function(n){var a=this;return r()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a.loading=!0,t.next=4,i.i(l.r)(n);case 4:e=t.sent,a.allData=e.data,a.total=e.count,a.loading=!1,a.getTotal(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.log(t.t0);case 14:case"end":return t.stop()}},t,a,[[0,11]])}))()},onSubmit:function(){this.currentPage=1,this.search()},search:function(){this.sum={quantityIn:0,quantityOut:0,remainCount:0,remainAmount:0},this.GetStockTicket({pageIndex:this.currentPage,pageSize:this.size,keywords:this.formInline.keywords.removeSP(),warehouseId:this.formInline.wareHouse,hospitalCode:this.formInline.hospitalCode,IsShowBatch:this.checked?1:0,IsShowZero:this.formInline.remainNum?1:0})},handleSizeChange:function(t){this.size=t,this.pageChange()},handleCurrentChange:function(t){this.currentPage=t,this.pageChange()},checkC:function(){this.search()},showNumDet:function(t,e,n){this.title=n,this.inOutDet=!0,this.detLoading=!0,this.GetTicketInOutRecord({TypeId:e,WarehouseId:t.warehouseId,TicketId:t.ticketId,Keywords:"",ticketPrefixCode:t.ticketPrefixCode,numCount:t.numCount})},GetTicketInOutRecord:function(n){var a=this;return r()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.i(l.s)(n);case 2:e=t.sent,a.detData=e.data,a.detLoading=!1;case 5:case"end":return t.stop()}},t,a)}))()},pageChange:function(){this.tableData=this.allData.slice((this.currentPage-1)*this.size,this.currentPage*this.size)},getTotal:function(){var e=this;this.allData.forEach(function(t){t.remainAmount=t.remainingCount.mul(t.salePrice),e.sum.quantityIn=t.quantityIn.add(e.sum.quantityIn),e.sum.quantityOut=t.quantityOut.add(e.sum.quantityOut),e.sum.remainCount=t.remainingCount.add(e.sum.remainCount),e.sum.remainAmount+=t.remainingCount.mul(t.salePrice)}),this.pageChange()}},components:{Export:c.a}}},1546:function(t,e,n){(t.exports=n(215)(!1)).push([t.i,".tag[data-v-fc906692]{margin:5px}",""])},1971:function(t,e,n){var a=n(1546);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n(216)("5bdc0c5c",a,!0)},2446:function(t,e){t.exports={render:function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("div",{staticClass:"tag selCommon"},[a("el-form",{staticClass:"demo-form-inline form_search",attrs:{inline:!0,model:n.formInline,"label-width":"80px"}},[a("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"医院："}},[a("el-select",{staticStyle:{width:"200px"},on:{change:n.hosChange},model:{value:n.formInline.hospitalCode,callback:function(t){n.$set(n.formInline,"hospitalCode",t)},expression:"formInline.hospitalCode"}},n._l(n.hospitalList,function(t,e){return a("el-option",{key:e,attrs:{label:t.supplierName,value:t.code}})}),1)],1),n._v(" "),a("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"仓库："}},[a("el-select",{staticStyle:{width:"200px"},model:{value:n.formInline.wareHouse,callback:function(t){n.$set(n.formInline,"wareHouse",t)},expression:"formInline.wareHouse"}},n._l(n.whList,function(t,e){return a("el-option",{key:e,attrs:{label:t.warehouseName,value:t.id}})}),1)],1),n._v(" "),a("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"关键字："}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&n._k(t.keyCode,"enter",13,t.key,"Enter")?null:n.onSubmit(t)}},model:{value:n.formInline.keywords,callback:function(t){n.$set(n.formInline,"keywords",t)},expression:"formInline.keywords"}})],1),n._v(" "),a("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"前缀："}},[a("el-checkbox",{on:{change:n.checkC},model:{value:n.checked,callback:function(t){n.checked=t},expression:"checked"}})],1),n._v(" "),a("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"零库存："}},[a("el-checkbox",{on:{change:n.onSubmit},model:{value:n.formInline.remainNum,callback:function(t){n.$set(n.formInline,"remainNum",t)},expression:"formInline.remainNum"}})],1),n._v(" "),a("el-form-item",{staticClass:"form_item_mt10",attrs:{label:""}},[a("el-button",{staticClass:"searchBtn",attrs:{type:"primary"},on:{click:n.onSubmit}},[n._v("查询")]),n._v(" "),a("Export",{ref:"exportTable",attrs:{tHeader:n.tHeader,filterVal:n.filterVal,tableData1:n.tableData1,name:n.name}})],1)],1),n._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticClass:"smt min_table",staticStyle:{width:"100%","margin-top":"15px","margin-bottom":"10px"},attrs:{data:n.tableData,border:"","max-height":"560","show-summary":"","summary-method":n.getSummaries}},[a("el-table-column",{attrs:{prop:"warehouseName",label:"仓库","min-width":"90"}}),n._v(" "),a("el-table-column",{attrs:{prop:"ticketName",label:"卡券名称","min-width":"90"}}),n._v(" "),a("el-table-column",{attrs:{prop:"ticketPrefixCode",label:"前缀","min-width":"90",align:"center"}}),n._v(" "),a("el-table-column",{attrs:{prop:"numCount",label:"流水号位数","min-width":"90",align:"center"}}),n._v(" "),a("el-table-column",{attrs:{prop:"salePrice",label:"价格","min-width":"90",align:"center"}}),n._v(" "),a("el-table-column",{attrs:{prop:"quantityIn",label:"入库总数","min-width":"90",align:"right"},scopedSlots:n._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return n.showNumDet(e.row,1,"入库")}}},[n._v(n._s(e.row.quantityIn))])]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"quantityOut",label:"出库总数","min-width":"90",align:"right"},scopedSlots:n._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return n.showNumDet(e.row,2,"出库")}}},[n._v(n._s(e.row.quantityOut))])]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"remainingCount",label:"库存数量","min-width":"90",align:"right"},scopedSlots:n._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return n.showReaminDet(e.row,"库存")}}},[n._v(n._s(e.row.remainingCount))])]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"remainAmount",label:"库存金额","min-width":"90",align:"right"}})],1),n._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":n.currentPage,"page-sizes":[10,20,30,40],"page-size":n.size,layout:"total, sizes, prev, pager, next, jumper",total:n.total},on:{"size-change":n.handleSizeChange,"current-change":n.handleCurrentChange}})],1),n._v(" "),a("el-dialog",{attrs:{title:n.title+"详情",visible:n.inOutDet,size:""},on:{"update:visible":function(t){n.inOutDet=t}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.detLoading,expression:"detLoading"}],staticStyle:{width:"1000px","margin-top":"15px","margin-bottom":"10px"},attrs:{data:n.detData,border:"",height:"460","show-summary":""}},[a("el-table-column",{attrs:{prop:"drugOutCode",label:n.title+"编号","min-width":"90"},scopedSlots:n._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:n._s(t.row.ticketInCode?t.row.ticketInCode:t.row.ticketOutCode)}})]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"drugInType",label:n.title+"日期","min-width":"90"},scopedSlots:n._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:n._s(t.row.ticketInDate?t.row.ticketInDate.substring(0,10):t.row.ticketOutDate.substring(0,10))}})]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"drugInType",label:n.title+"方式","min-width":"90"},scopedSlots:n._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:n._s(t.row.ticketInType?t.row.ticketInType:t.row.ticketOutType)}})]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"warehouseName",label:"仓库","min-width":"90"},scopedSlots:n._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:n._s((t.row.warehouseName,t.row.warehouseName))}})]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"ticketName",label:"卡券名称","min-width":"150"}}),n._v(" "),a("el-table-column",{attrs:{prop:"ticketPrefixCode",label:"前缀","min-width":"90"}}),n._v(" "),a("el-table-column",{attrs:{prop:"ticketName",label:"流水号位数","min-width":"90"},scopedSlots:n._u([{key:"default",fn:function(t){return[a("span",[n._v(n._s(t.row.numCount))])]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"ticketName",label:"价格","min-width":"90",align:"center"},scopedSlots:n._u([{key:"default",fn:function(t){return[a("span",[n._v(n._s(t.row.salePrice))])]}}])}),n._v(" "),a("el-table-column",{attrs:{prop:"quantity",label:"数量","min-width":"90",align:"right"}}),n._v(" "),a("el-table-column",{attrs:{prop:"ticketName",label:"操作","min-width":"90"},scopedSlots:n._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return n.viewTickets(e.row)}}},[n._v("查看详情")])]}}])})],1)],1),n._v(" "),a("el-dialog",{attrs:{title:n.title+"卡券详情",visible:n.ticketsDet,size:""},on:{"update:visible":function(t){n.ticketsDet=t}}},[a("Export",{ref:"exportTable",attrs:{tHeader:n.tHeader,filterVal:n.filterVal,tableData1:n.tableData1,name:n.name}}),n._v(" "),n.ticketsDet?a("div",{staticStyle:{width:"820px","min-height":"250px","max-height":"600px",overflow:"auto"}},n._l(n.dynamicTags,function(t){return a("el-tag",{key:t.code,staticClass:"tag",attrs:{type:"success"}},[n._v(n._s(t.code)+" ")])}),1):n._e()],1)],1)},staticRenderFns:[]}},431:function(t,e,n){n(1971);var a=n(98)(n(1200),n(2446),"data-v-fc906692",null);t.exports=a.exports},436:function(t,e,n){n(439);var a=n(98)(n(437),n(440),"data-v-6c47323e",null);t.exports=a.exports},437:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{tHeader:{},filterVal:{},tableData1:{type:Array},name:""},watch:{tableData1:{handler:function(t){this.otData=t},deep:!0}},data:function(){return{otData:[]}},methods:{handleDownload:function(){var n=this;a.e(220).then(function(){var t=a(448).export_json_to_excel,e=[];e=0!=n.otData.length?n.formatJson(n.filterVal,n.otData):n.formatJson(n.filterVal,n.tableData1),t(n.tHeader,e,n.name)}.bind(null,a)).catch(a.oe)},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){return e[t]})})}}}},438:function(t,e,n){(t.exports=n(215)(!1)).push([t.i,".exportBtn[data-v-6c47323e]{background:#fff;border:1px solid #d6d4d4;font-size:14px;color:#666;border-radius:4px}",""])},439:function(t,e,n){var a=n(438);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n(216)("fdf4f478",a,!0)},440:function(t,e){t.exports={render:function(){var t=this.$createElement;return(this._self._c||t)("el-button",{staticClass:"exportBtn",attrs:{type:"primary"},on:{click:this.handleDownload}},[this._v("导出报表")])},staticRenderFns:[]}}});