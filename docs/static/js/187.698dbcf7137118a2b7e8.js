webpackJsonp([187],{1134:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(37),s=r.n(a),o=r(100),l=r.n(o),n=r(99),i=r.n(n),u=r(65),c=(r.n(u),r(22)),m=r(64);t.default={data:function(){return{title:"",search:"",search_hos:"",dialogFormVisible:!1,consumeList:[],ticketData:[],labelPosition:"right",formLabelAlign:{},setTopList:[],hospital:[],ruleForm:{branch:"",num:1,check:!1,rate:"",comGrade:"",compRate:"",type:"",hospitalRate:"",HospitalLevel:[]},ope:"",rateList:[{rate:""}],topBranchList:[],rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}]}}},watch:{"ruleForm.check":{handler:function(e){0==e.length&&(this.ruleForm.rate="")},deep:!0}},computed:{},mounted:function(){this.getTopBranch()},methods:{AddExpendSet:function(t){var a=this;return i()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.i(m._330)(t);case 3:e.sent.success?(a.$message({message:"添加成功",type:"success"}),a.$refs.ruleForm.resetFields(),a.rateList=[{}],a.dialogFormVisible=!1,a.GetExpendSetByCode(),a.reset()):a.$message.error("添加失败"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),a.$message.error("添加失败");case 11:case"end":return e.stop()}},e,a,[[0,7]])}))()},UpdateExpendSet:function(t){var a=this;return i()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.i(m._331)(t);case 3:e.sent.success?(a.$message({message:"编辑成功",type:"success"}),a.$refs.ruleForm.resetFields(),a.rateList=[{}],a.dialogFormVisible=!1,a.GetExpendSetByCode()):a.$message.error("编辑失败"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),a.$message.error("编辑失败");case 11:case"end":return e.stop()}},e,a,[[0,7]])}))()},DeleteExpendSet:function(t){var a=this;return i()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.i(m._332)(t);case 3:e.sent.success?(a.$message({message:"删除成功",type:"success"}),a.GetExpendSetByCode()):a.$message.error("删除失败"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),a.$message.error("删除失败");case 11:case"end":return e.stop()}},e,a,[[0,7]])}))()},GetExpendSetByCode:function(){var a=this;return i()(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.i(m._333)({BranchCode:a.search});case 3:t=e.sent,a.ticketData=a.dealType(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,a,[[0,7]])}))()},getTopBranch:function(){var t=this;return i()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.i(m._194)();case 3:return t.topBranchList=e.sent,e.next=6,r.i(m.l)("0017");case 6:return t.consumeList=e.sent,e.next=9,r.i(m._334)();case 9:return t.setTopList=e.sent,e.next=12,r.i(m.a)({SupTypeCode:"001"});case 12:t.hospital=e.sent,t.dealData(t.consumeList),t.GetExpendSetByCode(),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0),t.$message.error("获取信息失败");case 21:case"end":return e.stop()}},e,t,[[0,17]])}))()},numCheck:function(e,t){var a=this;if(t||0==t){var r=this;setTimeout(function(){isNaN(Number(e))?a.$message.error("请输入数字"):r.rateList[t].rate=e},100),this.rateList.push()}else{var s=e.replace(/\D/g,"");this.$set(this.ruleForm,"rate",Number(s))}},edit:function(e,t){this.title="编辑";var a=JSON.parse(s()(t[e]));this.copyWorth(a),this.ope="edit",this.dialogFormVisible=!0},sure:function(){var e=this.dealRate(),t={branchCode:this.ruleForm.branch.split("|")[0],consumeTypeId:this.ruleForm.type,shareCount:this.ruleForm.num,rate1:this.getRate(e[0]),rate2:this.getRate(e[1]),rate3:this.getRate(e[2]),rate4:this.getRate(e[3]),rate5:this.getRate(e[4]),rate6:this.getRate(e[5]),rate7:this.getRate(e[6]),companyGradeNum:this.ruleForm.comGrade,companyRate:Number(this.ruleForm.compRate).div(100),createUserId:r.i(c.b)("userId"),createBy:r.i(c.b)("userName"),branchName:this.ruleForm.branch.split("|")[1],isAllocation:this.ruleForm.check,hospitalRate:Number(this.ruleForm.hospitalRate).div(100),HospitalLevel:this.ruleForm.HospitalLevel.join(",")};"add"==this.ope?this.AddExpendSet(t):(t.id=this.ruleForm.Id,this.UpdateExpendSet(t))},getRate:function(e){return isNaN(Number(e))?"":e},cancel:function(e){this.$refs[e].resetFields(),this.rateList=[{}],this.dialogFormVisible=!1,this.reset()},deleteRow:function(e,t){this.DeleteExpendSet({id:t[e].Id})},numChange:function(){var e=Number(this.ruleForm.num);this.rateList=[];for(var t=0;t<e;t++)this.rateList.push({rate:""})},add:function(){this.reset(),this.title="添加",this.ope="add",this.dialogFormVisible=!0},dealData:function(){var t=[];this.consumeList.forEach(function(e){"6"!=e.DataCode&&t.push(e)}),this.consumeList=t},dealRate:function(){var t=[];return this.rateList.forEach(function(e){t.push(Number(e.rate).div(100))}),t},submit:function(){this.GetExpendSetByCode({BranchCode:this.search})},dealType:function(e){var a=this;return e.forEach(function(e){for(var t=0;t<a.consumeList.length;t++)e.ConsumeTypeId==a.consumeList[t].DataCode&&(e.ConsumeTypeName=a.consumeList[t].DataName)}),e},copyWorth:function(e){for(var t in e)null==e[t]&&(e[t]="");this.ruleForm.Id=e.Id,this.ruleForm.branch=e.BranchCode+"|"+e.BranchName,this.ruleForm.type=e.ConsumeTypeId+"",this.ruleForm.num=e.ShareCount,this.rateList=this.getRateList(e.Rate1,e.Rate2,e.Rate3,e.Rate4,e.Rate5,e.Rate6,e.Rate7),this.ruleForm.type=e.ConsumeTypeId+"",this.ruleForm.comGrade=e.CompanyGradeNum+"",this.ruleForm.compRate=Number(e.CompanyRate).mul(100),this.ruleForm.hospitalRate=Number(e.HospitalRate).mul(100),this.ruleForm.HospitalLevel=e.HospitalLevel.split(",")},getRateList:function(){for(var e=[],t=arguments,a=0;a<t.length;a++)(0<t[a]||0===t[a])&&e.push({rate:t[a].mul(100)});return e},reset:function(){this.ruleForm={branch:"",num:1,check:!1,rate:"",comGrade:"",compRate:"",type:"",hospitalRate:"",HospitalLevel:[]},this.rateList=[{}]}},components:{}}},1238:function(e,t,a){(e.exports=a(215)(!1)).push([e.i,".dialog-footer[data-v-0c55b24f]{text-align:center}.table_container[data-v-0c55b24f]{width:100%;margin-top:20px}.demo-ruleForm[data-v-0c55b24f]{min-width:400px;max-width:600px}.form_item[data-v-0c55b24f]{width:200px}",""])},1663:function(e,t,a){var r=a(1238);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(216)("0aafb87c",r,!0)},2135:function(e,t){e.exports={render:function(){var r=this,e=r.$createElement,s=r._self._c||e;return s("div",{staticClass:"royaltyAllocate selCommon"},[s("el-form",{staticClass:"form_search",attrs:{inline:!0,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"总代理："}},[s("el-select",{on:{change:r.submit},model:{value:r.search,callback:function(e){r.search=e},expression:"search"}},[s("el-option",{attrs:{value:"全部",label:""}}),r._v(" "),r._l(r.setTopList,function(e,t){return s("el-option",{key:t,attrs:{value:e.BranchCode,label:e.BranchName}})})],2)],1),r._v(" "),s("el-form-item",{attrs:{label:"医院："}},[s("el-select",{on:{change:r.submit},model:{value:r.search_hos,callback:function(e){r.search_hos=e},expression:"search_hos"}},[s("el-option",{attrs:{value:"全部",label:""}}),r._v(" "),r._l(r.hospital,function(e,t){return s("el-option",{key:t,attrs:{value:e.SupplierName+"|"+e.Code,label:e.SupplierName}})})],2)],1),r._v(" "),s("el-form-item",{attrs:{label:"","label-width":"20px"}},[s("el-button",{attrs:{type:"primary"},on:{click:r.submit}},[r._v("搜索")])],1)],1),r._v(" "),s("div",{staticClass:"table_container"},[s("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:r.ticketData,"max-height":"450",border:""}},[s("el-table-column",{attrs:{type:"index",width:"70"}}),r._v(" "),s("el-table-column",{attrs:{prop:"BranchName",label:"总代","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.BranchCode?s("span",[r._v(r._s(e.row.BranchCode))]):r._e(),r._v(" "),e.row.BranchName?s("span",[r._v("["+r._s(e.row.BranchName)+"]")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"ConsumeTypeName",label:"提成类型","min-width":"100"}}),r._v(" "),s("el-table-column",{attrs:{prop:"ShareCount",label:"分成人数","min-width":"100"}}),r._v(" "),s("el-table-column",{attrs:{prop:"Rate1",label:"比例1","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.Rate1||"0"==e.row.Rate1?s("span",[r._v(r._s(e.row.Rate1.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"Rate2",label:"比例2","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.Rate2||"0"==e.row.Rate2?s("span",[r._v(r._s(e.row.Rate2.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"Rate3",label:"比例3","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.Rate3||"0"==e.row.Rate3?s("span",[r._v(r._s(e.row.Rate3.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"Rate4",label:"比例4","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.Rate4||"0"==e.row.Rate4?s("span",[r._v(r._s(e.row.Rate4.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"Rate5",label:"比例5","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.Rate5||"0"==e.row.Rate5?s("span",[r._v(r._s(e.row.Rate5.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"Rate6",label:"比例6","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.Rate6||"0"==e.row.Rate6?s("span",[r._v(r._s(e.row.Rate6.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"Rate7",label:"比例7","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.Rate7||"0"==e.row.Rate7?s("span",[r._v(r._s(e.row.Rate7.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"CompanyRate",label:"分公司比例","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.CompanyRate||"0"==e.row.CompanyRate?s("span",[r._v(r._s(e.row.CompanyRate.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"HospitalRate",label:"医院比例","min-width":"100"},scopedSlots:r._u([{key:"default",fn:function(e){return[e.row.HospitalRate||"0"==e.row.HospitalRate?s("span",[r._v(r._s(e.row.HospitalRate.mul(100))+"%")]):r._e()]}}])}),r._v(" "),s("el-table-column",{attrs:{prop:"HospitalLevel",label:"医院分配","min-width":"100"}}),r._v(" "),s("el-table-column",{attrs:{prop:"",label:"操作","min-width":"170"},scopedSlots:r._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"small",type:"primary",icon:"edit"},on:{click:function(e){return r.edit(t.$index,r.ticketData)}}},[r._v("编辑")]),r._v(" "),s("el-button",{attrs:{size:"small",icon:"delete"},on:{click:function(e){return r.deleteRow(t.$index,r.ticketData)}}},[r._v("删除")])]}}])})],1),r._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:r.add}},[r._v("添加")])],1),r._v(" "),s("el-dialog",{attrs:{title:r.title,visible:r.dialogFormVisible,size:""},on:{"update:visible":function(e){r.dialogFormVisible=e}}},[r.dialogFormVisible?s("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:r.ruleForm,rules:r.rules,"label-width":"110px"}},[s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"总代理：",prop:"branch"}},[s("el-select",{staticClass:"form_item",attrs:{filterable:""},model:{value:r.ruleForm.branch,callback:function(e){r.$set(r.ruleForm,"branch",e)},expression:"ruleForm.branch"}},[s("el-option",{attrs:{label:"默认",value:"0|默认"}}),r._v(" "),r._l(r.topBranchList,function(e,t){return s("el-option",{key:t,attrs:{label:e.BranchName,value:e.Code+"|"+e.BranchName}})})],2)],1),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"提成类型：",prop:"num"}},[s("el-select",{staticClass:"form_item",model:{value:r.ruleForm.type,callback:function(e){r.$set(r.ruleForm,"type",e)},expression:"ruleForm.type"}},r._l(r.consumeList,function(e){return s("el-option",{key:e.DataCode,attrs:{label:e.DataName,value:e.DataCode}})}),1)],1),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"提成分配人数：",prop:"num"}},[s("el-select",{staticClass:"form_item",on:{change:r.numChange},model:{value:r.ruleForm.num,callback:function(e){r.$set(r.ruleForm,"num",e)},expression:"ruleForm.num"}},[s("el-option",{attrs:{label:"1",value:"1"}}),r._v(" "),s("el-option",{attrs:{label:"2",value:"2"}}),r._v(" "),s("el-option",{attrs:{label:"3",value:"3"}}),r._v(" "),s("el-option",{attrs:{label:"4",value:"4"}}),r._v(" "),s("el-option",{attrs:{label:"5",value:"5"}}),r._v(" "),s("el-option",{attrs:{label:"6",value:"6"}}),r._v(" "),s("el-option",{attrs:{label:"7",value:"7"}})],1)],1),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"提成分配比率：",prop:"num"}},r._l(r.rateList,function(t,a){return s("span",{key:a},[s("el-input",{staticClass:"form_item",staticStyle:{margin:"5px 5px 0 0"},on:{change:function(e){return r.numCheck(t.rate,a)}},model:{value:t.rate,callback:function(e){r.$set(t,"rate",e)},expression:"item.rate"}},[s("template",{slot:"append"},[r._v("%")])],2)],1)}),0),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"总代是否提成：",prop:"num"}},[s("el-checkbox",{model:{value:r.ruleForm.check,callback:function(e){r.$set(r.ruleForm,"check",e)},expression:"ruleForm.check"}})],1),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"分公司等级：",prop:"num"}},[s("el-input",{staticClass:"form_item",model:{value:r.ruleForm.comGrade,callback:function(e){r.$set(r.ruleForm,"comGrade",e)},expression:"ruleForm.comGrade"}})],1),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"分公司提成比率：",prop:"num"}},[s("el-input",{staticClass:"form_item",model:{value:r.ruleForm.compRate,callback:function(e){r.$set(r.ruleForm,"compRate",e)},expression:"ruleForm.compRate"}},[s("template",{slot:"append"},[r._v("%")])],2)],1),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"医院提成比率：",prop:"num"}},[s("el-input",{staticClass:"form_item",model:{value:r.ruleForm.hospitalRate,callback:function(e){r.$set(r.ruleForm,"hospitalRate",e)},expression:"ruleForm.hospitalRate"}},[s("template",{slot:"append"},[r._v("%")])],2)],1),r._v(" "),s("el-form-item",{staticClass:"form_item_mt10",attrs:{label:"医院分配：",prop:"num"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:r.ruleForm.HospitalLevel,callback:function(e){r.$set(r.ruleForm,"HospitalLevel",e)},expression:"ruleForm.HospitalLevel"}},r._l(r.rateList,function(e,t){return s("el-option",{key:t,staticClass:"form_item",attrs:{label:t+1+"级",value:t}})}),1)],1)],1):r._e(),r._v(" "),s("div",{staticClass:"el-dialog__footer "},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){return r.sure("ruleForm")}}},[r._v("确定")]),r._v(" "),s("el-button",{on:{click:function(e){return r.cancel("ruleForm")}}},[r._v("取消")])],1)],1)],1)},staticRenderFns:[]}},390:function(e,t,a){a(1663);var r=a(98)(a(1134),a(2135),"data-v-0c55b24f",null);e.exports=r.exports}});