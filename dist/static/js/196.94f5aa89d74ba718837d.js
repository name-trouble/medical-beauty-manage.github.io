webpackJsonp([196],{1118:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(37),n=o.n(a),r=o(100),i=o.n(r),s=o(99),l=o.n(s),c=o(65),u=(o.n(c),o(22)),d=o(64);t.default={data:function(){return{saveLoading:!1,nameList:[{name:"医美",Code:"1"},{name:"美妆",Code:"2"},{name:"商城",Code:"3"}],pageSize:10,total:0,currentPage:1,currentIndex:0,gradeList:[],topBranchList:[],formInline:{name:"",grade:""},formLabelWidth:"90px",dialogFormVisible:!1,dialogDefaultVisible:!1,form:{branch:""},tableData:[],defaultData:[],loading:!0}},mounted:function(){this.getBranchGradeAll()},computed:{tHeader:function(){return["总代编号","总代","进货名称","进货折扣"]},filterVal:function(){return["BranchCode","BranchName","TypeName","Discount"]},tableData1:function(){return this.tableData},name:function(){return"代理消费折扣"}},methods:{updateDiscount:function(t){var a=this;return l()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.saveLoading=!0,e.next=4,o.i(d._335)(t);case 4:e.sent.success?(a.$message({message:"更新成功",type:"success"}),a.getGoods(0),a.dialogFormVisible=!1):a.$message.error("更新失败"),a.saveLoading=!1,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),a.$message.error("更新失败");case 13:case"end":return e.stop()}},e,a,[[0,9]])}))()},getTopBranch:function(){var a=this;return l()(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.i(d._194)();case 3:t=e.sent,a.topBranchList=t,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,a,[[0,7]])}))()},getGoods:function(e,t){var a=0;a=0==t?10:30,this.getGoodsDiscount({branchName:this.formInline.name,branchCode:e,BranchGradeCode:1==t?"":this.formInline.grade,pageIndex:this.currentPage,pageSize:a},t)},getGoodsDiscount:function(a,n){var r=this;return l()(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.i(d._336)(a);case 3:t=e.sent,0==n?(r.tableData=t,r.tableData.push(),0!=t.length?r.total=t[0].RecordCount:r.total=0):r.defaultData=t,r.getTopBranch(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,r,[[0,8]])}))()},getBranchGradeAll:function(){var a=this;return l()(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.i(d._319)();case 3:t=e.sent,a.gradeList=t,a.getGoods(0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,a,[[0,8]])}))()},addDiscount:function(t){var a=this;return l()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.saveLoading=!0,e.next=4,o.i(d._337)(t);case 4:e.sent.success?(a.$message({message:"操作成功",type:"success"}),0==a.currentIndex?a.getGoods(-1,0):a.getGoods(0,1)):a.$message.error("操作失败"),a.saveLoading=!1,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),a.$message.error("操作失败");case 13:case"end":return e.stop()}},e,a,[[0,9]])}))()},edit:function(e,t){this.dialogFormVisible=!0,this.form=JSON.parse(n()(t[e]))},editSure:function(){this.updateDiscount({id:this.form.Id,branchCode:this.form.BranchCode,Discount:this.form.Discount,typeCode:this.form.TypeCode,CreateUserId:o.i(u.b)("userId"),CreateBy:o.i(u.b)("userName")})},cancel:function(){this.dialogFormVisible=!1},onSubmit:function(){this.currentPage=1,this.search()},search:function(){this.getGoods(-1,0)},addSure:function(){this.dialogDefaultVisible=!1;var e=this.attrSplit(this.defaultData);this.addDiscount({jsonStr:n()(e)}),this.form.branch=""},addCancel:function(){this.dialogDefaultVisible=!1,this.form.branch=""},select:function(e){this.currentPage=1,this.pageSize=10,0==(this.currentIndex=e)?this.getGoods(-1,0):this.getGoods(0,1)},saveDefault:function(){for(var e=this.defaultData,t=this.defaultData.length,a=0;a<t;a++)e[a].BranchCode||(e[a].BranchCode=0),e[a].TypeCode||(e[a].TypeCode=e[a].TypeId);this.nullCheck(this.defaultData),this.addDiscount({jsonStr:n()(this.defaultData)})},nullCheck:function(e){e.forEach(function(e){if(!e.Discount)return e.Discount=0})},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.pageSize=e,this.getGoods(-1,0)},handleCurrentChange:function(e){console.log("当前页: "+e),this.currentPage=e,this.getGoods(-1,0)},add:function(){this.dialogDefaultVisible=!0,this.getGoods(0,1)},attrSplit:function(e){var t=this,a=[];return e.forEach(function(e){a.push({BranchCode:0<t.form.branch.length?t.form.branch.split("|")[0]:"",BranchName:0<t.form.branch.length?t.form.branch.split("|")[1]:"",Discount:e.Discount,TypeCode:e.TypeCode,CreateUserId:o.i(u.b)("userId"),CreateBy:o.i(u.b)("userName")})}),a}},components:{}}},1250:function(e,t,a){(e.exports=a(215)(!1)).push([e.i,".dialog_form_item[data-v-12c14a63]{margin-bottom:0}",""])},1675:function(e,t,a){var n=a(1250);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a(216)("239f996c",n,!0)},2147:function(e,t){e.exports={render:function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"DuesDiscount selCommon"},[n("ul",{staticStyle:{"margin-bottom":"20px"}},[n("li",{staticClass:"shelve",class:{active:0===a.currentIndex},on:{click:function(e){return a.select(0)}}},[a._v("总代理折扣")]),a._v(" "),n("li",{staticClass:"shelve",class:{active:1===a.currentIndex},on:{click:function(e){return a.select(1)}}},[a._v("默认折扣")])]),a._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:0==a.currentIndex,expression:"currentIndex == 0"}]},[n("el-form",{staticStyle:{background:"#f9f9f9","padding-top":"10px","margin-bottom":"20px"},attrs:{inline:!0,model:a.formInline,"label-width":"90px"}},[n("el-form-item",{attrs:{label:"总代理："}},[n("el-input",{attrs:{placeholder:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSubmit(e)}},model:{value:a.formInline.name,callback:function(e){a.$set(a.formInline,"name",e)},expression:"formInline.name"}})],1),a._v(" "),n("el-form-item",{attrs:{label:"进货名称："}},[n("el-select",{attrs:{placeholder:"请选择"},on:{change:a.onSubmit},model:{value:a.formInline.grade,callback:function(e){a.$set(a.formInline,"grade",e)},expression:"formInline.grade"}},[n("el-option",{attrs:{value:"",label:"全部"}}),a._v(" "),a._l(a.nameList,function(e){return n("el-option",{key:e.Code,attrs:{label:e.name,value:e.Code}})})],2)],1),a._v(" "),n("el-form-item",[n("el-button",{staticClass:"searchBtn",attrs:{type:"primary"},on:{click:a.onSubmit}},[a._v("查询")])],1)],1),a._v(" "),n("el-table",{staticClass:"min_table smt",staticStyle:{width:"850px"},attrs:{data:a.tableData,border:"","max-height":"560"}},[n("el-table-column",{attrs:{prop:"BranchCode",label:"总代编号","min-width":"120"}}),a._v(" "),n("el-table-column",{attrs:{prop:"BranchName",label:"总代","min-width":"120"}}),a._v(" "),n("el-table-column",{attrs:{prop:"TypeName",label:"进货名称","min-width":"120"}}),a._v(" "),n("el-table-column",{attrs:{prop:"Discount",label:"进货折扣","min-width":"120"}}),a._v(" "),n("el-table-column",{attrs:{label:"操作","min-width":"120"},scopedSlots:a._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return a.edit(t.$index,a.tableData)}}},[a._v("修改折扣")])]}}])})],1),a._v(" "),n("el-button",{staticStyle:{float:"left","margin-top":"20px"},attrs:{type:"primary"},on:{click:a.add}},[a._v("添加总代理")]),a._v(" "),n("div",{staticClass:"block",staticStyle:{float:"left","margin-top":"20px"}},[n("el-pagination",{attrs:{"current-page":a.currentPage,"page-sizes":[10,20,20,40],"page-size":a.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:a.total},on:{"size-change":a.handleSizeChange,"current-change":a.handleCurrentChange}})],1)],1),a._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:1==a.currentIndex,expression:"currentIndex == 1"}]},[n("el-table",{staticStyle:{width:"400px"},attrs:{data:a.defaultData,border:""}},[n("el-table-column",{attrs:{prop:"TypeName",label:"进货名称","min-width":"120"}}),a._v(" "),n("el-table-column",{attrs:{prop:"Discount",label:"进货折扣","min-width":"120"},scopedSlots:a._u([{key:"default",fn:function(t){return[n("el-input",{model:{value:t.row.Discount,callback:function(e){a.$set(t.row,"Discount",e)},expression:"scope.row.Discount"}})]}}])})],1),a._v(" "),n("el-button",{staticStyle:{"margin-top":"20px"},attrs:{type:"primary"},on:{click:a.saveDefault}},[a._v("保存")])],1),a._v(" "),n("el-dialog",{attrs:{title:"修改折扣",visible:a.dialogFormVisible,size:""},on:{"update:visible":function(e){a.dialogFormVisible=e}}},[n("el-form",{staticStyle:{width:"400px"},attrs:{model:a.form}},[n("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"总代：","label-width":a.formLabelWidth}},[n("span",[a._v(a._s(a.form.BranchName))])]),a._v(" "),n("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"进货名称：","label-width":a.formLabelWidth}},[n("span",[a._v(a._s(a.form.TypeName))])]),a._v(" "),n("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"进货折扣：","label-width":a.formLabelWidth}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:a.form.Discount,callback:function(e){a.$set(a.form,"Discount",e)},expression:"form.Discount"}})],1)],1),a._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",loading:a.saveLoading},on:{click:function(e){return a.editSure()}}},[a._v("确 定")]),a._v(" "),n("el-button",{on:{click:function(e){return a.cancel()}}},[a._v("取 消")])],1)],1),a._v(" "),n("el-dialog",{attrs:{title:"添加代理",visible:a.dialogDefaultVisible,size:""},on:{"update:visible":function(e){a.dialogDefaultVisible=e}}},[n("el-form",{staticStyle:{width:"400px"},attrs:{model:a.form}},[n("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"总代理：","label-width":a.formLabelWidth}},[n("el-select",{attrs:{filterable:""},model:{value:a.form.branch,callback:function(e){a.$set(a.form,"branch",e)},expression:"form.branch"}},a._l(a.topBranchList,function(e){return n("el-option",{key:e.Code,attrs:{label:e.BranchName,value:e.Code+"|"+e.BranchName}})}),1)],1),a._v(" "),n("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"折扣设置：","label-width":a.formLabelWidth}},[n("el-table",{staticStyle:{width:"400px"},attrs:{data:a.defaultData,border:""}},[n("el-table-column",{attrs:{prop:"TypeName",label:"进货名称","min-width":"120"}}),a._v(" "),n("el-table-column",{attrs:{prop:"Discount",label:"进货折扣","min-width":"120"},scopedSlots:a._u([{key:"default",fn:function(t){return[n("el-input",{model:{value:t.row.Discount,callback:function(e){a.$set(t.row,"Discount",e)},expression:"scope.row.Discount"}})]}}])})],1)],1)],1),a._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",loading:a.saveLoading},on:{click:function(e){return a.addSure()}}},[a._v("确 定")]),a._v(" "),n("el-button",{on:{click:function(e){return a.addCancel()}}},[a._v("取 消")])],1)],1)],1)},staticRenderFns:[]}},376:function(e,t,a){a(1675);var n=a(98)(a(1118),a(2147),"data-v-12c14a63",null);e.exports=n.exports}});