webpackJsonp([195],{1119:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(37),a=i.n(r),n=i(100),l=i.n(n),o=i(99),c=i.n(o),s=i(65),u=(i.n(s),i(22)),d=i(64);t.default={data:function(){return{topBranchList:[],gradeList:[],pageSize:10,total:0,currentPage:1,currentIndex:0,formInline:{name:"",grade:""},formLabelWidth:"90px",dialogFormVisible:!1,dialogDefaultVisible:!1,form:{branch:""},tableData:[],defaultData:[],loading:!0}},computed:{tHeader:function(){return["总代编号","总代","等级序号","价格","押金","进货折扣","进货价格"]},filterVal:function(){return["BranchCode","BranchName","OrderNum","Price","Pledge","Discount","StockPrice"]},tableData1:function(){return this.tableData},name:function(){return"代理会费折扣"}},watch:{defaultData:{handler:function(e){e.forEach(function(e){})},deep:!0}},mounted:function(){this.getBranchGradeAll()},methods:{updateFareSet:function(t){var r=this;return c()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.i(d._338)(t);case 3:e.sent.success?(r.$message({message:"更新成功",type:"success"}),r.getGradeFare(-1,0),r.dialogFormVisible=!1):r.$message.error("更新失败"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),r.$message.error("更新失败");case 11:case"end":return e.stop()}},e,r,[[0,7]])}))()},getTopBranch:function(){var r=this;return c()(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.i(d._194)();case 3:t=e.sent,r.topBranchList=t,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,r,[[0,7]])}))()},addBranchFareSet:function(t){var r=this;return c()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.i(d._339)(t);case 3:e.sent.success?(r.$message({message:"操作成功",type:"success"}),0==r.currentIndex?(r.getGradeFare(-1,0),r.dialogDefaultVisible=!1):r.getGradeFare(0,1)):r.$message.error("操作失败"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),r.$message.error("操作失败");case 11:case"end":return e.stop()}},e,r,[[0,7]])}))()},getGradeFare:function(e,t){this.getGradeFareSet({branchName:this.formInline.name,branchCode:e,BranchGradeCode:1==t?"":this.formInline.grade,pageIndex:this.currentPage,pageSize:this.pageSize},t)},getGradeFareSet:function(a,n){var o=this;return c()(l.a.mark(function e(){var t,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.i(d._340)(a);case 3:t=e.sent,r=[],t.forEach(function(e){0!=e.OrderNum&&r.push(e)}),0==n?0!=(o.tableData=r).length?o.total=r[0].RecordCount:o.total=0:o.defaultData=o.sortData(r),o.getTopBranch(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,o,[[0,10]])}))()},getBranchGradeAll:function(){var r=this;return c()(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.i(d._319)();case 3:t=e.sent,r.gradeList=r.getOrderNum(t),r.getGradeFare(-1,0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,r,[[0,8]])}))()},edit:function(e,t){this.dialogFormVisible=!0,this.form=JSON.parse(a()(t[e]))},editSure:function(){this.dialogFormVisible=!1,this.updateFareSet({id:this.form.Id,branchCode:this.form.BranchCode,branchTypeCode:this.form.BranchTypeCode,price:this.form.Price,pledge:this.form.Pledge,discount:this.form.Discount,stockPrice:this.form.StockPrice,CreateUserId:i.i(u.b)("userId"),CreateBy:i.i(u.b)("userName")})},cancel:function(){this.dialogFormVisible=!1},onSubmit:function(){this.currentPage=1,this.search()},search:function(){this.getGradeFare(-1,0)},addSure:function(){var e=this.attrSplit(this.defaultData);this.addBranchFareSet({jsonStr:a()(e)})},addCancel:function(){this.dialogDefaultVisible=!1},select:function(e){0==(this.currentIndex=e)?this.getGradeFare(-1,0):this.getGradeFare(0,1)},saveDefault:function(){for(var e=this.defaultData,t=this.defaultData.length,r=0;r<t;r++)0==e[r].BranchCode.length&&(e[r].BranchCode=0),0==e[r].BranchTypeCode.length&&(e[r].BranchTypeCode=e[r].Code);this.addBranchFareSet({jsonStr:a()(this.defaultData)})},numberCheck:function(e,t,r){1<=t.length&&setTimeout(function(){t[r].Price&&(t[r].Price=Number(String(t[r].Price).replace(/\D/g,""))),t[r].Pledge&&(t[r].Pledge=Number(String(t[r].Pledge).replace(/\D/g,""))),t[r].Discount&&(t[r].Discount=Number(String(t[r].Discount).replace(/\D/g,"")),100<t[r].Discount?t[r].Discount=100:t[r].Discount<0&&(t[r].Discount=0),t[r].Discount)},50)},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.pageSize=e,this.getGradeFare(-1,0)},handleCurrentChange:function(e){console.log("当前页: "+e),this.currentPage=e,this.getGradeFare(-1,0)},add:function(){this.dialogDefaultVisible=!0,this.getGradeFare(0,1)},attrSplit:function(e){var t=this,r=[];return e.forEach(function(e){r.push({branchCode:t.form.branch,BranchTypeCode:e.BranchTypeCode,price:e.Price,pledge:e.Pledge,discount:e.Discount,stockPrice:e.StockPrice,CreateUserId:i.i(u.b)("userId"),CreateBy:i.i(u.b)("userName")})}),r},sortData:function(e){for(var t=void 0,r=0;r<e.length;r++)for(var a=r+1;a<e.length;a++)e[r].OrderNum>e[a].OrderNum&&(t=e[a],e[a]=e[r],e[r]=t);return e},getOrderNum:function(e){var t=[],r=[];e.forEach(function(e){t.push(e.OrderNum)}),t.sort();for(var a=0;a<t.length-1;a++)if(t[a]!=t[a+1]&&r.push(t[a]),a>=t.length-2){r.push(t[a+1]);break}return r},deleteRow:function(){}},components:{}}},1378:function(e,t,r){(e.exports=r(215)(!1)).push([e.i,".dialog_form_item[data-v-5103f06c]{margin-bottom:0}",""])},1803:function(e,t,r){var a=r(1378);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r(216)("abfbfe2c",a,!0)},2276:function(e,t){e.exports={render:function(){var r=this,e=r.$createElement,a=r._self._c||e;return a("div",{staticClass:"ConsumeDiscount selCommon"},[a("ul",{staticStyle:{"margin-bottom":"20px"}},[a("li",{staticClass:"shelve",class:{active:0===r.currentIndex},on:{click:function(e){return r.select(0)}}},[r._v("总代理折扣")]),r._v(" "),a("li",{staticClass:"shelve",class:{active:1===r.currentIndex},on:{click:function(e){return r.select(1)}}},[r._v("默认折扣")])]),r._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0==r.currentIndex,expression:"currentIndex == 0"}]},[a("el-form",{staticStyle:{background:"#f9f9f9","padding-top":"10px","margin-bottom":"20px"},attrs:{inline:!0,model:r.formInline,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"总代理："}},[a("el-input",{attrs:{placeholder:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&r._k(e.keyCode,"enter",13,e.key,"Enter")?null:r.onSubmit(e)}},model:{value:r.formInline.name,callback:function(e){r.$set(r.formInline,"name",e)},expression:"formInline.name"}})],1),r._v(" "),a("el-form-item",{attrs:{label:"等级序号："}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:r.onSubmit},model:{value:r.formInline.grade,callback:function(e){r.$set(r.formInline,"grade",e)},expression:"formInline.grade"}},[a("el-option",{attrs:{value:"",label:"全部"}}),r._v(" "),r._l(r.gradeList,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})],2)],1),r._v(" "),a("el-form-item",[a("el-button",{staticClass:"searchBtn",attrs:{type:"primary"},on:{click:r.onSubmit}},[r._v("查询")])],1)],1),r._v(" "),a("el-table",{staticStyle:{width:"1200px"},attrs:{data:r.tableData,border:"",height:"500"}},[a("el-table-column",{attrs:{prop:"BranchCode",label:"总代编号","min-width":"120"}}),r._v(" "),a("el-table-column",{attrs:{prop:"BranchName",label:"总代","min-width":"120"}}),r._v(" "),a("el-table-column",{attrs:{prop:"OrderNum",label:"等级序号","min-width":"100"}}),r._v(" "),a("el-table-column",{attrs:{prop:"Price",label:"等级","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(e){return[r._v("\n                    "+r._s(e.row.GradeName)+"\n                ")]}}])}),r._v(" "),a("el-table-column",{attrs:{prop:"Price",label:"价格","min-width":"120"}}),r._v(" "),a("el-table-column",{attrs:{prop:"Pledge",label:"押金","min-width":"120"}}),r._v(" "),a("el-table-column",{attrs:{prop:"Discount",label:"进货折扣","min-width":"120"}}),r._v(" "),a("el-table-column",{attrs:{prop:"StockPrice",label:"进货价格","min-width":"120"}}),r._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"130"},scopedSlots:r._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return r.edit(t.$index,r.tableData)}}},[r._v("修改折扣")])]}}])})],1),r._v(" "),a("el-button",{staticStyle:{float:"left","margin-top":"20px"},attrs:{type:"primary"},on:{click:r.add}},[r._v("添加总代理")]),r._v(" "),a("div",{staticClass:"block",staticStyle:{float:"left","margin-top":"20px"}},[a("el-pagination",{attrs:{"current-page":r.currentPage,"page-sizes":[10,20,30,40],"page-size":r.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:r.total},on:{"size-change":r.handleSizeChange,"current-change":r.handleCurrentChange}})],1)],1),r._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==r.currentIndex,expression:"currentIndex == 1"}]},[a("el-table",{staticStyle:{width:"750px"},attrs:{data:r.defaultData,border:""}},[a("el-table-column",{attrs:{prop:"OrderNum",label:"等级序号","min-width":"120"}}),r._v(" "),a("el-table-column",{attrs:{prop:"Price",label:"等级","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(e){return[r._v("\n                    "+r._s(e.row.GradeName)+"\n                ")]}}])}),r._v(" "),a("el-table-column",{attrs:{prop:"Price",label:"价格","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(t){return[a("el-input",{on:{change:function(e){return r.numberCheck(t.row.Price,r.defaultData,t.$index)}},model:{value:t.row.Price,callback:function(e){r.$set(t.row,"Price",e)},expression:"scope.row.Price"}})]}}])}),r._v(" "),a("el-table-column",{attrs:{prop:"Pledge",label:"押金","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(t){return[a("el-input",{on:{change:function(e){return r.numberCheck(t.row.Pledge,r.defaultData,t.$index)}},model:{value:t.row.Pledge,callback:function(e){r.$set(t.row,"Pledge",e)},expression:"scope.row.Pledge"}})]}}])}),r._v(" "),a("el-table-column",{attrs:{prop:"Discount",label:"进货折扣","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(t){return[a("el-input",{on:{change:function(e){return r.numberCheck(t.row.Discount,r.defaultData,t.$index)}},model:{value:t.row.Discount,callback:function(e){r.$set(t.row,"Discount",e)},expression:"scope.row.Discount"}})]}}])}),r._v(" "),a("el-table-column",{attrs:{prop:"StockPrice",label:"进货价格","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(t){return[a("el-input",{on:{change:function(e){return r.numberCheck(t.row.Discount,r.defaultData,t.$index)}},model:{value:t.row.StockPrice,callback:function(e){r.$set(t.row,"StockPrice",e)},expression:"scope.row.StockPrice"}})]}}])})],1),r._v(" "),a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary"},on:{click:r.saveDefault}},[r._v("保存")])],1),r._v(" "),a("el-dialog",{attrs:{title:"修改折扣",visible:r.dialogFormVisible,size:""},on:{"update:visible":function(e){r.dialogFormVisible=e}}},[a("el-form",{staticStyle:{width:"350px"},attrs:{model:r.form}},[a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"总代理：","label-width":r.formLabelWidth}},[a("span",[r._v(r._s(r.form.BranchName))])]),r._v(" "),a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"等级序号：","label-width":r.formLabelWidth}},[a("span",[r._v(r._s(r.form.OrderNum))])]),r._v(" "),a("el-table-column",{attrs:{prop:"Price",label:"等级","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(e){return[r._v("\n                    "+r._s(e.row.GradeName)+"\n                ")]}}])}),r._v(" "),a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"金额：","label-width":r.formLabelWidth}},[a("el-input",{staticStyle:{width:"200px"},model:{value:r.form.Price,callback:function(e){r.$set(r.form,"Price",e)},expression:"form.Price"}})],1),r._v(" "),a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"押金：","label-width":r.formLabelWidth}},[a("el-input",{staticStyle:{width:"200px"},attrs:{"auto-complete":"off"},model:{value:r.form.Pledge,callback:function(e){r.$set(r.form,"Pledge",e)},expression:"form.Pledge"}})],1),r._v(" "),a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"进货折扣：","label-width":r.formLabelWidth}},[a("el-input",{staticStyle:{width:"200px"},attrs:{"auto-complete":"off"},model:{value:r.form.Discount,callback:function(e){r.$set(r.form,"Discount",e)},expression:"form.Discount"}},[a("template",{slot:"append"},[r._v("%")])],2)],1),r._v(" "),a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"进货价格：","label-width":r.formLabelWidth}},[a("el-input",{staticStyle:{width:"200px"},attrs:{"auto-complete":"off"},model:{value:r.form.StockPrice,callback:function(e){r.$set(r.form,"StockPrice",e)},expression:"form.StockPrice"}})],1)],1),r._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return r.editSure()}}},[r._v("确 定")]),r._v(" "),a("el-button",{on:{click:function(e){return r.cancel()}}},[r._v("取 消")])],1)],1),r._v(" "),a("el-dialog",{attrs:{title:"添加总代理",visible:r.dialogDefaultVisible,size:""},on:{"update:visible":function(e){r.dialogDefaultVisible=e}}},[a("el-form",{staticStyle:{width:"650px"},attrs:{model:r.form}},[a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"总代理：","label-width":r.formLabelWidth}},[a("el-select",{attrs:{filterable:""},model:{value:r.form.branch,callback:function(e){r.$set(r.form,"branch",e)},expression:"form.branch"}},r._l(r.topBranchList,function(e){return a("el-option",{key:e.Code,attrs:{label:e.Code+"|"+e.BranchName,value:e.Code}})}),1)],1),r._v(" "),a("el-form-item",{staticClass:"dialog_form_item",attrs:{label:"设置折扣：","label-width":r.formLabelWidth}},[a("el-table",{staticStyle:{width:"550px"},attrs:{data:r.defaultData,border:""}},[a("el-table-column",{attrs:{prop:"OrderNum",label:"等级序号","min-width":"80"}}),r._v(" "),a("el-table-column",{attrs:{prop:"Price",label:"等级","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(e){return[r._v("\n                            "+r._s(e.row.GradeName)+"\n                        ")]}}])}),r._v(" "),a("el-table-column",{attrs:{prop:"Price",label:"金额","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(t){return[a("el-input",{on:{change:function(e){return r.numberCheck(t.row.Price,r.defaultData,t.$index)}},model:{value:t.row.Price,callback:function(e){r.$set(t.row,"Price",e)},expression:"scope.row.Price"}})]}}])}),r._v(" "),a("el-table-column",{attrs:{prop:"Pledge",label:"押金","min-width":"120"},scopedSlots:r._u([{key:"default",fn:function(t){return[a("el-input",{on:{change:function(e){return r.numberCheck(t.row.Pledge,r.defaultData,t.$index)}},model:{value:t.row.Pledge,callback:function(e){r.$set(t.row,"Pledge",e)},expression:"scope.row.Pledge"}})]}}])})],1)],1)],1),r._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return r.addSure()}}},[r._v("确 定")]),r._v(" "),a("el-button",{on:{click:function(e){return r.addCancel()}}},[r._v("取 消")])],1)],1)],1)},staticRenderFns:[]}},377:function(e,t,r){r(1803);var a=r(98)(r(1119),r(2276),"data-v-5103f06c",null);e.exports=a.exports}});